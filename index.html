<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DJIæ¤ä¿æ©Ÿ è¾²å™´è¨ˆç®—å™¨</title>
    <style>
        :root {
            /* è®Šæ•¸è¨­å®šï¼šèƒŒæ™¯ä¸å†æ˜¯ç´”è‰²ï¼Œè€Œæ˜¯åœ–ç‰‡ */
            --bg-overlay: rgba(243, 244, 246, 0.6); /* ç™½å¤©èƒŒæ™¯é®ç½© (æ·¡ç°) */
            --card-bg: rgba(255, 255, 255, 0.85);   /* å¡ç‰‡åŠé€æ˜ç™½ */
            --text-main: #1f2937;
            --text-sub: #4b5563;
            --primary: #2563eb;
            --accent: #d97706;
            --input-bg: rgba(255, 255, 255, 0.9);
            --input-border: #d1d5db;
            --input-text: #111827;
            --result-bg: rgba(239, 246, 255, 0.8);
            --result-border: #bfdbfe;
            --backdrop-blur: blur(12px); /* æ¯›ç»ç’ƒæ¨¡ç³Šåº¦ */
        }

        /* å¤œé–“æ¨¡å¼ï¼šåŠ æ·±èƒŒæ™¯èˆ‡å¡ç‰‡é¡è‰² */
        @media (prefers-color-scheme: dark) {
            :root {
                --bg-overlay: rgba(15, 23, 42, 0.85); /* å¤œé–“èƒŒæ™¯é®ç½© (æ·±é»‘è—) */
                --card-bg: rgba(30, 41, 59, 0.85);    /* å¡ç‰‡åŠé€æ˜é»‘ */
                --text-main: #f3f4f6;
                --text-sub: #9ca3af;
                --primary: #60a5fa;
                --accent: #fbbf24;
                --input-bg: rgba(251, 191, 36, 0.95); /* ç¶­æŒé»ƒåº•ï¼Œç¨å¾®ä¸é€æ˜ä¸€é» */
                --input-border: #b45309;
                --input-text: #000000;
                --result-bg: rgba(37, 99, 235, 0.25);
                --result-border: #1e40af;
            }
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 0;
            -webkit-text-size-adjust: 100%;
            color: var(--text-main);

            /* === èƒŒæ™¯åœ–è¨­å®šå€ (é€™è£¡æ”¹åœ–ç‰‡) === */
            /* é è¨­ä½¿ç”¨ bg.jpg (æ‚¨çš„ç…§ç‰‡)ï¼Œè‹¥ç„¡å‰‡ä½¿ç”¨å¾Œå‚™é¡è‰² */
            background-image: var(--bg-image, url('bg.jpg')); 
            /* å¦‚æœæ‚¨æƒ³ç”¨ DJI çš„åœ–ï¼Œè«‹æŠŠä¸Šé¢é‚£è¡Œæ›æˆä¸‹é¢é€™è¡Œï¼š */
            /* background-image: url('https://www1.djicdn.com/cms/uploads/56d80f07fa3159e04f117104a52fcaee.png'); */
            
            background-size: cover;       /* å¡«æ»¿è¢å¹• */
            background-position: center;  /* å±…ä¸­ */
            background-attachment: fixed; /* å›ºå®šèƒŒæ™¯ä¸æ²å‹• */
            background-color: #333;       /* åœ–ç‰‡è¼‰å…¥å‰çš„åº•è‰² */
            
            min-height: 100vh;
        }

        /* å…¨è¢å¹•é®ç½©ï¼šç”¨ä¾†èª¿æ•´èƒŒæ™¯åœ–çš„äº®åº¦ï¼Œè®“æ–‡å­—æ›´æ¸…æ¥š */
        body::before {
            content: "";
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: var(--bg-overlay);
            z-index: -1; /* æ”¾åœ¨å…§å®¹å¾Œé¢ï¼ŒèƒŒæ™¯åœ–å‰é¢ */
        }

        /* å°èˆªåˆ—ï¼šä¹ŸåŠ ä¸Šæ¯›ç»ç’ƒæ•ˆæœ */
        .nav-tabs {
            display: flex;
            background: var(--card-bg);
            backdrop-filter: var(--backdrop-blur);
            -webkit-backdrop-filter: var(--backdrop-blur);
            padding: 10px 10px 0 10px;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .nav-item {
            flex: 1;
            text-align: center;
            padding: 15px 10px;
            font-size: 15px;
            font-weight: bold;
            color: var(--text-sub);
            border-bottom: 3px solid transparent;
            cursor: pointer;
            white-space: nowrap;
        }

        .nav-item.active {
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
        }

        .container {
            padding: 15px;
            max-width: 900px;
            margin: 0 auto;
            padding-bottom: 80px;
        }

        .tab-content { display: none; animation: fadeIn 0.4s ease-out; }
        .tab-content.active { display: block; }

        @keyframes fadeIn { 
            from { opacity: 0; transform: translateY(10px); } 
            to { opacity: 1; transform: translateY(0); } 
        }

        /* å¡ç‰‡æ¨£å¼ï¼šæ¯›ç»ç’ƒç‰¹æ•ˆ */
        .card {
            background: var(--card-bg);
            backdrop-filter: var(--backdrop-blur);        /* æ¨¡ç³ŠèƒŒæ™¯ */
            -webkit-backdrop-filter: var(--backdrop-blur); /* Safari æ”¯æ´ */
            border: 1px solid rgba(255, 255, 255, 0.2);   /* å¾®å¾®ç™¼å…‰çš„é‚Šæ¡† */
            border-radius: 16px; /* æ›´åœ“æ½¤ä¸€é» */
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        h2 {
            margin-top: 0;
            font-size: 18px;
            border-left: 5px solid var(--accent);
            padding-left: 12px;
            margin-bottom: 18px;
            color: var(--text-main);
            text-shadow: 0 0 1px rgba(0,0,0,0.05); /* è®“æ¨™é¡Œæ›´ç«‹é«” */
        }

        .input-group { margin-bottom: 15px; }
        
        label {
            display: block;
            font-size: 16px; /* å€å¡Šå…§çš„labelæ–‡å­—è¨­å®š */
            color: var(--text-sub);
            margin-bottom: 6px;
            font-weight: 600;
        }

        input, select {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            border: 1px solid var(--input-border);
            border-radius: 10px;
            background-color: var(--input-bg);
            color: var(--input-text);
            font-weight: bold;
            box-sizing: border-box;
            outline: none;
            transition: all 0.2s;
        }

        input:focus {
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.3);
            border-color: var(--primary);
            transform: scale(1.01); /* èšç„¦æ™‚å¾®å¾®æ”¾å¤§ */
        }

        button.btn-calc {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, var(--primary), #1e40af); /* æ¼¸å±¤æŒ‰éˆ• */
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            margin-top: 15px;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(37, 99, 235, 0.2);
            transition: transform 0.1s;
        }
        button.btn-calc:active { transform: scale(0.97); }

        /* çµæœé¡¯ç¤ºå€ */
        .result-box {
            background-color: var(--result-bg);
            border: 1px solid var(--result-border);
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            margin-top: 12px;
        }
        .result-value { font-size: 28px; font-weight: 900; color: var(--primary); }
        .result-unit { font-size: 14px; color: var(--text-sub); }

        /* æ··è—¥è¡¨æ ¼ */
        table.mix-table {
            width: 100%;
            border-collapse: separate; /* ç‚ºäº†åœ“è§’ */
            border-spacing: 0;
            min-width: 650px; 
            border: 1px solid rgba(0,0,0,0.1);
            border-radius: 8px;
            overflow: hidden;
        }
        table.mix-table th, table.mix-table td {
            padding: 10px;
            text-align: center;
            font-size: 14px;
            vertical-align: middle;
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }
        table.mix-table th { 
            background: rgba(0,0,0,0.03); 
            color: var(--text-main); 
            font-weight: 700;
        }
        table.mix-table input, table.mix-table select {
            font-size: 14px; padding: 8px; margin: 0; width: 100%; border: 1px solid #ccc;
        }
        
        /* åŠ‘å‹æ¨™ç±¤ */
        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 6px;
            color: white;
            font-size: 12px;
            font-weight: bold;
            box-shadow: 0 2px 2px rgba(0,0,0,0.1);
        }
        .badge-1 { background: linear-gradient(to right, #ea580c, #c2410c); } 
        .badge-2 { background: linear-gradient(to right, #854d0e, #713f12); } 
        .badge-3 { background: linear-gradient(to right, #15803d, #14532d); } 
        .badge-4 { background: linear-gradient(to right, #0284c7, #0369a1); } 
        .badge-5 { background: linear-gradient(to right, #7e22ce, #581c87); } 
        .badge-6 { background: linear-gradient(to right, #be123c, #881337); } 

        .step-num {
            display: inline-block;
            width: 26px; height: 26px;
            background: var(--text-main);
            color: var(--input-bg);
            border-radius: 50%;
            line-height: 26px;
            text-align: center;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .alert-info {
            background-color: rgba(59, 130, 246, 0.1);
            border-left: 4px solid var(--primary);
            padding: 12px;
            border-radius: 0 8px 8px 0;
            margin-bottom: 15px;
            font-size: 14px;
            color: var(--text-main);
            line-height: 1.5;
        }
        
        .toggle-group {
            display: flex;
            background: rgba(0,0,0,0.05);
            padding: 4px;
            border-radius: 10px;
            margin-bottom: 15px;
        }
        .toggle-btn {
            flex: 1;
            text-align: center;
            padding: 10px;
            font-size: 14px;
            border-radius: 8px;
            cursor: pointer;
            color: var(--text-sub);
            transition: all 0.2s;
        }
        .toggle-btn.active {
            background: var(--card-bg);
            color: var(--primary);
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>

    <div class="nav-tabs">
        <div class="nav-item active" onclick="switchMainTab('tab-drone', this)">
            ğŸš æ¤ä¿æ©Ÿç•ç”¨é‡è¨ˆç®—å™¨
        </div>
        <div class="nav-item" onclick="switchMainTab('tab-cocktail', this)">
            ğŸ§ª å¤šåˆä¸€è¾²è—¥èª¿é…
        </div>
        <div class="nav-item" onclick="switchMainTab('tab-pesticide', this)">
            ğŸ’§ å–®é …è¾²è—¥ç¨€é‡‹
        </div>
    </div>

    <div class="container">

        <div id="tab-drone" class="tab-content active">
            <div class="card">
                <h2>è—¥æ°´ç”¨é‡è¨ˆç®—</h2>
                <div class="input-group">
                    <label>è¨ˆç•«æ¯åˆ†åœ°å™´ç‘ç”¨é‡ (å…¬å‡)</label>
                    <input type="number" id="sprayPerFen" placeholder="ä¾‹å¦‚ï¼š10" oninput="calcDrone()">
                </div>
                
                <div class="input-group">
                    <label style="color:var(--accent);">æ¯åˆ†åœ°é¡å¤–é å‚™æ°´é‡ (äººå·¥è£œå™´ç”¨)</label>
                    <input type="number" id="extraWater" placeholder="ä¾‹å¦‚ï¼š0.5" value="0.5" oninput="calcDrone()" style="border-color:var(--accent); color:var(--input-text); font-weight:bold;">
                </div>

                <div class="result-box">
                    <div class="result-title">è¨­å®šå™´ç‘ç•ç”¨é‡å€¼ (å«è‡ªå‹•è£œå„Ÿ +0.05)</div>
                    <div>
                        <span class="result-value" id="sprayPerMu">0.00</span>
                        <span class="result-unit">(å‡/ç•)</span>
                    </div>
                    <div style="font-size:12px; color:var(--text-sub); margin-top:5px; padding:0 10px;">
                        âš ï¸ <strong>æ³¨æ„ï¼š</strong>è«‹å°‡æ­¤æ•¸å€¼è¼¸å…¥é™æ§å™¨ã€‚æ­¤æ•¸å€¼<strong>ä¸åŒ…å«</strong>äººå·¥è£œå™´æ°´é‡ï¼Œä»¥ç¢ºä¿é£›æ©ŸæŒ‰æ¨™æº–é£›è¡Œä¸¦ä¿ç•™æ®˜æ¶²ã€‚
                    </div>
                </div>

                <div class="input-group" style="margin-top:20px;">
                    <label>è«‹è¼¸å…¥å¯¦éš›ä½œæ¥­é¢ç© (ç•)ï¼š</label>
                    <input type="number" id="actualMu" placeholder="ä¾‹å¦‚ï¼š7.5" oninput="calcDrone()">
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <div class="result-box">
                        <div class="result-title">æ›ç®—åˆ†åœ°</div>
                        <span class="result-value" id="fenResult">0.00</span>
                    </div>
                    <div class="result-box" style="border-color:var(--accent);">
                        <div class="result-title" style="color:var(--accent); font-weight:bold;">ç¸½éœ€å‚™è—¥æ°´é‡</div>
                        <span class="result-value" id="totalSprayMu" style="color:var(--accent);">0.00</span>
                        <div style="font-size:11px; color:var(--text-sub);">(å«é£›è¡Œç”¨é‡+äººå·¥è£œå™´)</div>
                    </div>
                </div>
                
                <div class="result-box" style="background: rgba(255, 69, 0, 0.1); border-color: rgba(255, 69, 0, 0.3); margin-top: 22px;">
                    <div class="result-title">ä¸€ç”²åœ° (ç´„ 14.54 ç•) éœ€è¦çš„è—¥æ°´ç”¨é‡</div>
                    <div>
                        <span class="result-value" id="sprayPerJia" style="color: #ff4500;">0.00</span>
                        <span class="result-unit">(å…¬å‡)</span>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>åƒæ•¸ç´€éŒ„ (æ‰‹å‹•)</h2>
                <div class="input-group">
                    <label>è¨­å®šç•ç”¨é‡ (å‡/ç•)</label>
                    <input type="number" id="record_mu_dosage" readonly style="background: rgba(0,0,0,0.05); color: var(--text-sub); border:none;">
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <div class="input-group">
                        <label>æµé€Ÿ (å‡/åˆ†é˜)</label>
                        <input type="number" id="record_flow">
                    </div>
                    <div class="input-group">
                        <label>é€Ÿåº¦ (ç§’/å…¬å°º)</label>
                        <input type="number" id="record_speed">
                    </div>
                </div>
                <div class="input-group">
                    <label>ç¸½è—¥é‡ï¼ˆå‡ï¼‰</label>
                    <input type="number" id="record_total">
                </div>
            </div>
        </div>

        <div id="tab-cocktail" class="tab-content">
            <div class="card">
                <h2>1. è¨­å®šä½œæ¥­æ¢ä»¶</h2>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <div class="input-group">
                        <label>ä½œæ¥­é¢ç© (ç”²)</label>
                        <input type="number" id="cocktail_area" placeholder="ä¾‹å¦‚ï¼š1.5" onchange="calcCocktailTotal()">
                    </div>
                    <div class="input-group">
                        <label>æ¯åˆ†åœ°ç”¨æ°´é‡ (å…¬å‡)</label>
                        <input type="number" id="cocktail_water_per_fen" placeholder="æ¨™æº–ï¼š10~20" value="10" onchange="calcCocktailTotal()">
                    </div>
                </div>
                
                <div class="result-box" style="margin-bottom: 20px;">
                    <div class="result-title">æœ¬è¶Ÿé è¨ˆç¸½éœ€æ°´é‡</div>
                    <div>
                        <span class="result-value" id="cocktail_total_water">0</span>
                        <span class="result-unit">å…¬å‡ (L)</span>
                    </div>
                    <div style="font-size:12px; color:var(--text-sub); margin-top:5px;">
                        (å…¬å¼ï¼šç”² Ã— 10åˆ† Ã— æ¯åˆ†ç”¨æ°´é‡)
                    </div>
                </div>

                <h2>2. è¼¸å…¥è¾²è—¥æ¸…å–® (æœ€å¤š8ç­†)</h2>
                <div class="alert-info">
                    <strong>ğŸ’¡ ç³»çµ±æ™ºæ…§åŠŸèƒ½ï¼š</strong> è¼¸å…¥é †åºä¸é™ï¼ŒæŒ‰ä¸‹è¨ˆç®—å¾Œï¼Œç³»çµ±å°‡è‡ªå‹•æ ¹æ“šã€ŒåŠ‘å‹ã€é‡æ–°æ’åˆ—ç¬¦åˆ <strong>WALES</strong> åŸå‰‡çš„æœ€ä½³æŠ•è—¥é †åºã€‚
                </div>
                
                <div style="overflow-x: auto;">
                    <table class="mix-table" id="mixTable">
                        <thead>
                            <tr>
                                <th style="width:25%">è¾²è—¥åŠ‘å‹</th>
                                <th style="width:20%">è¾²è—¥åç¨±</th>
                                <th style="width:20%">è¨ˆç®—æ–¹å¼</th>
                                <th style="width:15%">æ•¸å€¼</th>
                                <th style="width:15%">å®¹é‡(cc/g)</th>
                                <th style="width:5%">æ¸…</th>
                            </tr>
                        </thead>
                        <tbody id="mixBody">
                            </tbody>
                    </table>
                </div>

                <button class="btn-calc" onclick="sortAndCalcCocktail()" style="background: linear-gradient(135deg, var(--success), #047857); margin-top: 20px;">
                    ğŸ”„ è¾²è—¥æ··åˆé †åºèˆ‡è¨ˆç®—ç”¨é‡ (Calculate & Sort)
                </button>

                <div id="cocktail_results" style="margin-top:20px; display:none;">
                    <h2>3. å»ºè­°æŠ•è—¥é †åºè¡¨</h2>
                    <div style="margin-bottom:10px; font-size:14px; font-weight:bold; color:var(--text-main);">
                        ğŸ’¦ è«‹å…ˆåœ¨æ¡¶å…§æ³¨å…¥ <span style="color:var(--primary);">åŠæ¡¶æ°´</span>ï¼Œå†ä¾åºåŠ å…¥ï¼š
                    </div>
                    <table class="mix-table">
                        <thead>
                            <tr>
                                <th>é †åº</th>
                                <th>å»ºè­°åŠ‘å‹é †ä½</th>
                                <th>è—¥å</th>
                                <th>æœ¬è¶Ÿç¸½è—¥é‡</th>
                                <th>é ä¼°è¦æ ¼é‡</th>
                            </tr>
                        </thead>
                        <tbody id="cocktail_result_body"></tbody>
                    </table>
                    <div class="alert-info" style="margin-top:15px;">
                        * <strong>æ²¹æ€§/ä¹³åŠ‘ (EC, OD)</strong> å»ºè­°è¼ƒæ™šåŠ å…¥ï¼Œé¿å…æ²¹è†œåŒ…è¦†ç²‰åŠ‘é€ æˆçµå¡Šã€‚<br>
                        * <strong>å±•è‘—åŠ‘</strong> å»ºè­°æœ€å¾ŒåŠ å…¥ï¼Œé¿å…ç”¢ç”Ÿéå¤šæ³¡æ²«å½±éŸ¿æ°´ä½åˆ¤æ–·ã€‚
                    </div>
                </div>
            </div>
        </div>

        <div id="tab-pesticide" class="tab-content">
            <div class="card">
                <div class="toggle-group">
                    <div class="toggle-btn active" onclick="switchPesMode('mode-dilution', this)">ğŸ’§ ç®—ç¨€é‡‹ (å·²çŸ¥è—¥é‡)</div>
                    <div class="toggle-btn" onclick="switchPesMode('mode-amount', this)">ğŸ’Š ç®—è—¥é‡ (å·²çŸ¥æ°´é‡)</div>
                </div>
                <div id="mode-dilution" class="pes-mode">
                    <div class="input-group">
                        <label>è¾²è—¥åç¨±</label>
                        <input type="text" id="p_name">
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <div class="input-group">
                            <label>è—¥é‡ (cc/g)</label>
                            <input type="number" id="p_amount" placeholder="500">
                        </div>
                        <div class="input-group">
                            <label>ç¨€é‡‹å€æ•¸</label>
                            <input type="number" id="p_ratio" placeholder="1000">
                        </div>
                    </div>
                    <button class="btn-calc" onclick="calcDilution()">è¨ˆç®—</button>
                    <div id="dilution-result" style="display:none; margin-top:15px;">
                        <div class="result-box">
                            <div>éœ€åŠ æ°´é‡ï¼š<span id="res_water_need" style="font-size:20px; font-weight:bold;">0</span> L</div>
                            <div>ç¸½è—¥æ¶²é‡ï¼š<span id="res_total" style="font-size:20px; font-weight:bold;">0</span> L</div>
                        </div>
                    </div>
                </div>

                <div id="mode-amount" class="pes-mode" style="display:none;">
                    <div class="input-group">
                        <label>ç›®æ¨™ç¸½æ°´é‡ (å…¬å‡)</label>
                        <input type="number" id="a_water" placeholder="100">
                    </div>
                    <div class="input-group">
                        <label>ç¨€é‡‹å€æ•¸</label>
                        <input type="number" id="a_ratio" placeholder="500">
                    </div>
                    <button class="btn-calc" onclick="calcAmount()">è¨ˆç®—</button>
                    <div id="amount-result" style="display:none; margin-top:15px;">
                        <div class="result-box">
                            <div>éœ€è¦è¾²è—¥ï¼š<span id="res_pest_need" style="font-size:24px; font-weight:bold;">0</span> cc(g)</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        initMixTable();
        document.querySelectorAll("input").forEach(el => {
            el.addEventListener("click", function() { this.select(); });
        });
    });

    function switchMainTab(tabId, btn) {
        document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        btn.classList.add('active');
    }

    function switchPesMode(modeId, btn) {
        document.querySelectorAll('.pes-mode').forEach(el => el.style.display = 'none');
        document.querySelectorAll('.toggle-btn').forEach(el => el.classList.remove('active'));
        document.getElementById(modeId).style.display = 'block';
        btn.classList.add('active');
    }

    // --- Tab 2: å¤šåˆä¸€è¾²è—¥èª¿é…é‚è¼¯ (WALESåŸå‰‡) ---
    const FORMULATION_ORDER = {
        "fert":  { rank: 1, name: "è‚¥æ–™/èª¿ç¯€åŠ‘", badge: "badge-1" },
        "solid": { rank: 2, name: "å›ºé«” (WP/WG/SP)", badge: "badge-2" }, 
        "sc":    { rank: 3, name: "æ‡¸æµ® (SC/CS)", badge: "badge-3" }, 
        "sl":    { rank: 4, name: "æ°´åŠ‘ (SL/EW)", badge: "badge-4" },    
        "oil":   { rank: 5, name: "æ²¹æ€§ (EC/OD)", badge: "badge-5" },    
        "adj":   { rank: 6, name: "å±•è‘—åŠ‘", badge: "badge-6" },          
        "other": { rank: 9, name: "å…¶ä»–", badge: "" }
    };

    function initMixTable() {
        const tbody = document.getElementById("mixBody");
        tbody.innerHTML = "";
        for(let i=0; i<8; i++) {
            const tr = document.createElement("tr");
            tr.innerHTML = `
                <td>
                    <select class="mix-type" style="font-size:13px;">
                        <option value="fert">1.è‚¥æ–™/èª¿ç¯€åŠ‘</option>
                        <option value="solid" selected>2.å›ºé«” (WP,WG,SP,GR,DP,EG,SG)</option>
                        <option value="sc">3.æ‡¸æµ® (SC,DC,CS,SE)</option>
                        <option value="sl">4.æ°´åŠ‘ (SL,ME,EW)</option>
                        <option value="oil">5.ä¹³åŠ‘/æ²¹ (EC,OD,OF,OL)</option>
                        <option value="adj">6.å±•è‘—åŠ‘</option>
                    </select>
                </td>
                <td><input type="text" class="mix-name" placeholder="è—¥å"></td>
                <td>
                    <select class="mix-method" onchange="toggleMixInput(this)">
                        <option value="ratio">ç¨€é‡‹å€æ•¸</option>
                        <option value="area">æ¯å…¬é ƒç”¨é‡</option>
                    </select>
                </td>
                <td><input type="number" class="mix-val" placeholder="ä¾‹: 1000"></td>
                <td><input type="number" class="mix-pack" placeholder="è¦æ ¼"></td>
                <td><button onclick="clearRow(this)" style="background:#f3f4f6;border:1px solid #ccc;border-radius:4px;width:30px;height:30px;">âŒ</button></td>
            `;
            tbody.appendChild(tr);
        }
    }

    function toggleMixInput(selectEl) {
        const row = selectEl.closest("tr");
        const valInput = row.querySelector(".mix-val");
        if(selectEl.value === "ratio") valInput.placeholder = "ä¾‹: 1000";
        else valInput.placeholder = "ä¾‹: 1.5 (Læˆ–kg)";
    }

    function clearRow(btn) {
        const row = btn.closest("tr");
        row.querySelectorAll("input").forEach(i => i.value = "");
        row.querySelector(".mix-type").value = "solid";
    }

    function calcCocktailTotal() {
        const jia = parseFloat(document.getElementById("cocktail_area").value) || 0;
        const waterPerFen = parseFloat(document.getElementById("cocktail_water_per_fen").value) || 0;
        const totalWater = jia * 10 * waterPerFen;
        document.getElementById("cocktail_total_water").innerText = totalWater.toFixed(0);
        return { totalWater, jia };
    }

    function sortAndCalcCocktail() {
        const { totalWater, jia } = calcCocktailTotal();
        if(totalWater <= 0) { alert("è«‹å…ˆè¼¸å…¥æœ‰æ•ˆçš„ä½œæ¥­é¢ç©(ç”²)èˆ‡æ¯åˆ†åœ°ç”¨æ°´é‡"); return; }

        let list = [];
        const rows = document.querySelectorAll("#mixBody tr");
        
        rows.forEach(row => {
            const name = row.querySelector(".mix-name").value.trim();
            const type = row.querySelector(".mix-type").value;
            const method = row.querySelector(".mix-method").value;
            const val = parseFloat(row.querySelector(".mix-val").value);
            const pack = parseFloat(row.querySelector(".mix-pack").value);

            if(val > 0) { 
                list.push({ name: name || "(æœªå‘½å)", type, method, val, pack });
            }
        });

        if(list.length === 0) { alert("è«‹è‡³å°‘è¼¸å…¥ä¸€ç¨®è¾²è—¥è³‡æ–™"); return; }

        list.sort((a, b) => FORMULATION_ORDER[a.type].rank - FORMULATION_ORDER[b.type].rank);

        const resBody = document.getElementById("cocktail_result_body");
        resBody.innerHTML = "";
        
        list.forEach((item, idx) => {
            let amount = 0;
            let amountText = "";
            let packText = "-";

            if(item.method === "ratio" && item.val > 0) {
                amount = totalWater / item.val; 
                let cc = amount * 1000; 
                amountText = `${cc.toFixed(0)} cc(g)`;
                if(item.pack > 0) {
                    let packs = cc / item.pack;
                    packText = `${packs.toFixed(1)} ç½(åŒ…)`;
                }
            } else if(item.method === "area" && item.val > 0) {
                const ha = jia * 0.9699;
                let totalL = ha * item.val; 
                let cc = totalL * 1000;
                amountText = `${cc.toFixed(0)} cc(g)`;
                if(item.pack > 0) {
                    let packs = cc / item.pack;
                    packText = `${packs.toFixed(1)} ç½(åŒ…)`;
                }
            }

            const typeInfo = FORMULATION_ORDER[item.type];
            const tr = document.createElement("tr");
            tr.innerHTML = `
                <td><span class="step-num">${idx+1}</span></td>
                <td><span class="badge ${typeInfo.badge}">${typeInfo.name}</span></td>
                <td style="font-weight:bold;">${item.name}</td>
                <td style="color:var(--primary); font-weight:900; font-size:18px;">${amountText}</td>
                <td style="color:var(--text-sub);">${packText}</td>
            `;
            resBody.appendChild(tr);
        });

        document.getElementById("cocktail_results").style.display = "block";
        setTimeout(() => {
            document.getElementById("cocktail_results").scrollIntoView({ behavior: 'smooth', block: 'start' });
        }, 100);
    }

    // --- Tab 1: æ¤ä¿æ©Ÿç•ç”¨é‡è¨ˆç®— ---
    function calcDrone() {
        const sprayPerFen = parseFloat(document.getElementById('sprayPerFen').value);
        const extraWater = parseFloat(document.getElementById('extraWater').value) || 0; 
        const actualMu = parseFloat(document.getElementById('actualMu').value);
        const muToFen = 0.687; 
        const jiaCoef = 14.54; 

        if (!isNaN(sprayPerFen)) {
            const sprayPerMuNum = (sprayPerFen * muToFen) + 0.05;
            document.getElementById('sprayPerMu').innerText = sprayPerMuNum.toFixed(2);
            document.getElementById('record_mu_dosage').value = sprayPerMuNum.toFixed(2);

            if (!isNaN(actualMu)) {
                const fenArea = actualMu * muToFen;
                document.getElementById('fenResult').innerText = fenArea.toFixed(2);
                
                const totalMix = (actualMu * sprayPerMuNum) + (fenArea * extraWater);
                document.getElementById('totalSprayMu').innerText = totalMix.toFixed(2);
                
                const sprayPerJia = (jiaCoef * sprayPerMuNum).toFixed(2);
                document.getElementById('sprayPerJia').textContent = sprayPerJia;
            }
        }
    }

    // --- Tab 3: å–®é …ç¨€é‡‹ ---
    function calcDilution() {
        const amount = parseFloat(document.getElementById("p_amount").value);
        const dilution = parseFloat(document.getElementById("p_ratio").value);
        if(amount>0 && dilution>0){
            const amountL = amount / 1000;
            const water = amountL * (dilution - 1);
            const total = amountL + water;
            document.getElementById("res_water_need").innerText = water.toFixed(2);
            document.getElementById("res_total").innerText = total.toFixed(2);
            document.getElementById("dilution-result").style.display = "block";
        }
    }

    function calcAmount() {
        const water = parseFloat(document.getElementById("a_water").value);
        const ratio = parseFloat(document.getElementById("a_ratio").value);
        if(water>0 && ratio>0){
            const pest = (water / ratio) * 1000;
            document.getElementById("res_pest_need").innerText = pest.toFixed(1);
            document.getElementById("amount-result").style.display = "block";
        }
    }
</script>
</body>
</html>