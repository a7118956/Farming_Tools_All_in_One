<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ™ºæ…§è¾²å™´è¨ˆç®—å™¨</title>
    <style>
        :root {
            --bg-color: #f3f4f6;
            --card-bg: #ffffff;
            --text-main: #1f2937;
            --text-sub: #4b5563;
            --primary: #2563eb;       /* è—è‰²ä¸»èª¿ */
            --accent: #d97706;        /* æ©˜é»ƒå¼·èª¿ */
            --success: #059669;       /* ç¶ è‰² */
            --input-bg: #fff;
            --input-border: #d1d5db;
            --input-text: #111827;
            --result-bg: #eff6ff;
            --result-border: #bfdbfe;
        }

        /* å¤œé–“æ¨¡å¼ (Dark Mode) */
        @media (prefers-color-scheme: dark) {
            :root {
                --bg-color: #0f172a;
                --card-bg: #1e293b;
                --text-main: #f3f4f6;
                --text-sub: #9ca3af;
                --primary: #60a5fa;
                --accent: #fbbf24;
                --success: #34d399;
                --input-bg: #fbbf24; /* ç¶­æŒé«˜å°æ¯”é»ƒè‰²è¼¸å…¥æ¡† */
                --input-border: #b45309;
                --input-text: #000000;
                --result-bg: rgba(37, 99, 235, 0.2);
                --result-border: #1e40af;
            }
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 0;
            -webkit-text-size-adjust: 100%;
        }

        /* å°èˆªåˆ— */
        .nav-tabs {
            display: flex;
            background: var(--card-bg);
            padding: 10px 10px 0 10px;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            overflow-x: auto;
        }

        .nav-item {
            flex: 1;
            text-align: center;
            padding: 15px 10px;
            font-size: 15px;
            font-weight: bold;
            color: var(--text-sub);
            border-bottom: 3px solid transparent;
            cursor: pointer;
            white-space: nowrap;
        }

        .nav-item.active {
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
        }

        .container {
            padding: 15px;
            max-width: 900px;
            margin: 0 auto;
            padding-bottom: 80px;
        }

        .tab-content { display: none; animation: fadeIn 0.3s; }
        .tab-content.active { display: block; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* å¡ç‰‡èˆ‡é€šç”¨å…ƒä»¶ */
        .card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            overflow-x: auto;
        }

        h2 {
            margin-top: 0;
            font-size: 18px;
            border-left: 4px solid var(--accent);
            padding-left: 10px;
            margin-bottom: 15px;
            color: var(--text-main);
        }

        .input-group { margin-bottom: 15px; }
        
        label {
            display: block;
            font-size: 14px;
            color: var(--text-sub);
            margin-bottom: 6px;
            font-weight: 600;
        }

        input, select {
            width: 100%;
            padding: 10px;
            font-size: 16px;
            border: 1px solid var(--input-border);
            border-radius: 6px;
            background-color: var(--input-bg);
            color: var(--input-text);
            font-weight: bold;
            box-sizing: border-box;
            outline: none;
        }

        button.btn-calc {
            width: 100%;
            padding: 14px;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            margin-top: 10px;
            cursor: pointer;
        }
        button.btn-calc:active { transform: scale(0.98); }

        /* çµæœé¡¯ç¤ºå€ */
        .result-box {
            background-color: var(--result-bg);
            border: 1px solid var(--result-border);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            margin-top: 10px;
        }
        .result-value { font-size: 24px; font-weight: 900; color: var(--primary); }
        .result-unit { font-size: 14px; color: var(--text-sub); }

        /* æ··è—¥è¡¨æ ¼æ¨£å¼ */
        table.mix-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 650px; /* æ‰‹æ©Ÿä¸Šå¯æ©«å‘æ²å‹• */
        }
        table.mix-table th, table.mix-table td {
            border: 1px solid var(--input-border);
            padding: 8px;
            text-align: center;
            font-size: 14px;
            vertical-align: middle;
        }
        table.mix-table th { background: rgba(0,0,0,0.05); color: var(--text-main); }
        table.mix-table input, table.mix-table select {
            font-size: 14px; padding: 6px; margin: 0; width: 100%; border: 1px solid #ccc;
        }
        
        /* åŠ‘å‹æ¨™ç±¤ (Badge) */
        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            color: white;
            font-size: 12px;
            font-weight: bold;
            text-shadow: 0 1px 1px rgba(0,0,0,0.2);
        }
        /* 1. è‚¥æ–™ */
        .badge-1 { background: #ea580c; } 
        /* 2. å›ºé«”ç²‰åŠ‘ */
        .badge-2 { background: #854d0e; } 
        /* 3. æ‡¸æµ®åŠ‘ */
        .badge-3 { background: #15803d; } 
        /* 4. æ°´åŠ‘ */
        .badge-4 { background: #0284c7; } 
        /* 5. æ²¹æ€§/ä¹³åŠ‘ */
        .badge-5 { background: #7e22ce; } 
        /* 6. å±•è‘—åŠ‘ */
        .badge-6 { background: #be123c; } 

        .step-num {
            display: inline-block;
            width: 24px;
            height: 24px;
            background: var(--text-main);
            color: var(--bg-color);
            border-radius: 50%;
            line-height: 24px;
            text-align: center;
            font-weight: bold;
        }
        
        /* æç¤ºå€å¡Š */
        .alert-info {
            background-color: rgba(59, 130, 246, 0.1);
            border-left: 4px solid var(--primary);
            padding: 10px;
            margin-bottom: 15px;
            font-size: 13px;
            color: var(--text-main);
            line-height: 1.5;
        }
        
        .toggle-group {
            display: flex;
            background: #e5e7eb;
            padding: 4px;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        .toggle-btn {
            flex: 1;
            text-align: center;
            padding: 8px;
            font-size: 14px;
            border-radius: 6px;
            cursor: pointer;
            color: #4b5563;
        }
        .toggle-btn.active {
            background: white;
            color: var(--primary);
            font-weight: bold;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        @media (prefers-color-scheme: dark) {
            .toggle-group { background: #374151; }
            .toggle-btn { color: #9ca3af; }
            .toggle-btn.active { background: #1f2937; color: var(--accent); }
        }
    </style>
</head>
<body>

    <div class="nav-tabs">
        <div class="nav-item active" onclick="switchMainTab('tab-drone', this)">
            ğŸš æ¤ä¿æ©Ÿç•ç”¨é‡è¨ˆç®—å™¨
        </div>
        <div class="nav-item" onclick="switchMainTab('tab-cocktail', this)">
            ğŸ§ª å¤šåˆä¸€è¾²è—¥èª¿é…
        </div>
        <div class="nav-item" onclick="switchMainTab('tab-pesticide', this)">
            ğŸ’§ å–®é …è¾²è—¥ç¨€é‡‹
        </div>
    </div>

    <div class="container">

        <div id="tab-drone" class="tab-content active">
            <div class="card">
                <h2>è—¥æ°´ç”¨é‡è¨ˆç®—</h2>
                <div class="input-group">
                    <label>æ¯åˆ†åœ°å™´ç‘ç”¨é‡ (å…¬å‡=å‡)</label>
                    <input type="number" id="sprayPerFen" placeholder="ä¾‹å¦‚ï¼š10" oninput="calcDrone()">
                </div>
                <div class="result-box">
                    <div class="result-title">è¨­å®šå™´ç‘ç•ç”¨é‡å€¼ (è‡ªå‹•è£œå„Ÿ +0.05)</div>
                    <div>
                        <span class="result-value" id="sprayPerMu">0.00</span>
                        <span class="result-unit">(å‡/ç•)</span>
                    </div>
                </div>
                <div class="input-group" style="margin-top:20px;">
                    <label>è«‹è¼¸å…¥å¯¦éš›ä½œæ¥­é¢ç© (ç•)ï¼š</label>
                    <input type="number" id="actualMu" placeholder="ä¾‹å¦‚ï¼š7.5" oninput="calcDrone()">
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <div class="result-box">
                        <div class="result-title">æ›ç®—åˆ†åœ°</div>
                        <span class="result-value" id="fenResult">0.00</span>
                    </div>
                    <div class="result-box">
                        <div class="result-title">ç¸½è—¥é‡</div>
                        <span class="result-value" id="totalSprayMu">0.00</span>
                    </div>
                </div>
                <div class="result-box" style="background: rgba(255, 69, 0, 0.1); border-color: rgba(255, 69, 0, 0.3); margin-top: 22px;">
                    <div class="result-title">ä¸€ç”²åœ° (ç´„ 14.54 ç•) éœ€è¦çš„è—¥æ°´ç”¨é‡</div>
                    <div>
                        <span class="result-value" id="sprayPerJia" style="color: #ff4500;">0.00</span>
                        <span class="result-unit">(å…¬å‡)</span>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>åƒæ•¸ç´€éŒ„ (æ‰‹å‹•)</h2>
                <div class="input-group">
                    <label>è¨­å®šç•ç”¨é‡ (å‡/ç•)</label>
                    <input type="number" id="record_mu_dosage" readonly style="background: var(--bg-color); color: var(--text-sub); border:none;">
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <div class="input-group">
                        <label>æµé€Ÿ (å‡/åˆ†é˜)</label>
                        <input type="number" id="record_flow">
                    </div>
                    <div class="input-group">
                        <label>é€Ÿåº¦ (ç§’/å…¬å°º)</label>
                        <input type="number" id="record_speed">
                    </div>
                </div>
                <div class="input-group">
                    <label>ç¸½è—¥é‡ï¼ˆå‡ï¼‰</label>
                    <input type="number" id="record_total">
                </div>
            </div>
        </div>

        <div id="tab-cocktail" class="tab-content">
            <div class="card">
                <h2>1. è¨­å®šä½œæ¥­æ¢ä»¶</h2>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <div class="input-group">
                        <label>ä½œæ¥­é¢ç© (ç”²)</label>
                        <input type="number" id="cocktail_area" placeholder="ä¾‹å¦‚ï¼š1.5" onchange="calcCocktailTotal()">
                    </div>
                    <div class="input-group">
                        <label>æ¯åˆ†åœ°ç”¨æ°´é‡ (å…¬å‡)</label>
                        <input type="number" id="cocktail_water_per_fen" placeholder="æ¨™æº–ï¼š10~20" value="10" onchange="calcCocktailTotal()">
                    </div>
                </div>
                
                <div class="result-box" style="margin-bottom: 20px;">
                    <div class="result-title">æœ¬è¶Ÿé è¨ˆç¸½éœ€æ°´é‡</div>
                    <div>
                        <span class="result-value" id="cocktail_total_water">0</span>
                        <span class="result-unit">å…¬å‡ (L)</span>
                    </div>
                    <div style="font-size:12px; color:var(--text-sub); margin-top:5px;">
                        (å…¬å¼ï¼šç”² Ã— 10åˆ† Ã— æ¯åˆ†ç”¨æ°´é‡)
                    </div>
                </div>

                <h2>2. è¼¸å…¥è¾²è—¥æ¸…å–® (æœ€å¤š8ç­†)</h2>
                <div class="alert-info">
                    <strong>ğŸ’¡ ç³»çµ±æ™ºæ…§åŠŸèƒ½ï¼š</strong> è¼¸å…¥é †åºä¸é™ï¼ŒæŒ‰ä¸‹è¨ˆç®—å¾Œï¼Œç³»çµ±å°‡è‡ªå‹•æ ¹æ“šã€ŒåŠ‘å‹ã€é‡æ–°æ’åˆ—ç¬¦åˆ <strong>WALES</strong> åŸå‰‡çš„æœ€ä½³æŠ•è—¥é †åºã€‚
                </div>
                
                <div style="overflow-x: auto;">
                    <table class="mix-table" id="mixTable">
                        <thead>
                            <tr>
                                <th style="width:25%">åŠ‘å‹ (Group)</th>
                                <th style="width:20%">åç¨± (Name)</th>
                                <th style="width:20%">è¨ˆç®—æ–¹å¼</th>
                                <th style="width:15%">æ•¸å€¼</th>
                                <th style="width:15%">åŒ…è£(cc/g)</th>
                                <th style="width:5%">æ¸…</th>
                            </tr>
                        </thead>
                        <tbody id="mixBody">
                            </tbody>
                    </table>
                </div>

                <button class="btn-calc" onclick="sortAndCalcCocktail()" style="background-color: var(--success); margin-top: 20px;">
                    ğŸ”„ æ™ºæ…§æ’åºä¸¦è¨ˆç®—ç”¨é‡ (Calculate & Sort)
                </button>

                <div id="cocktail_results" style="margin-top:20px; display:none;">
                    <h2>3. å»ºè­°æŠ•è—¥é †åºè¡¨</h2>
                    <div style="margin-bottom:10px; font-size:14px; font-weight:bold; color:var(--text-main);">
                        ğŸ’¦ è«‹å…ˆåœ¨æ¡¶å…§æ³¨å…¥ <span style="color:var(--primary);">åŠæ¡¶æ°´</span>ï¼Œå†ä¾åºåŠ å…¥ï¼š
                    </div>
                    <table class="mix-table">
                        <thead>
                            <tr>
                                <th>é †åº</th>
                                <th>å»ºè­°åŠ‘å‹é †ä½</th>
                                <th>è—¥å</th>
                                <th>æœ¬è¶Ÿç¸½è—¥é‡</th>
                                <th>é ä¼°è¦æ ¼é‡</th>
                            </tr>
                        </thead>
                        <tbody id="cocktail_result_body"></tbody>
                    </table>
                    <div class="alert-info" style="margin-top:15px;">
                        * <strong>æ²¹æ€§/ä¹³åŠ‘ (EC, OD)</strong> å»ºè­°è¼ƒæ™šåŠ å…¥ï¼Œé¿å…æ²¹è†œåŒ…è¦†ç²‰åŠ‘é€ æˆçµå¡Šã€‚<br>
                        * <strong>å±•è‘—åŠ‘</strong> å»ºè­°æœ€å¾ŒåŠ å…¥ï¼Œé¿å…ç”¢ç”Ÿéå¤šæ³¡æ²«å½±éŸ¿æ°´ä½åˆ¤æ–·ã€‚
                    </div>
                </div>
            </div>
        </div>

        <div id="tab-pesticide" class="tab-content">
            <div class="card">
                <div class="toggle-group">
                    <div class="toggle-btn active" onclick="switchPesMode('mode-dilution', this)">ğŸ’§ ç®—ç¨€é‡‹ (å·²çŸ¥è—¥é‡)</div>
                    <div class="toggle-btn" onclick="switchPesMode('mode-amount', this)">ğŸ’Š ç®—è—¥é‡ (å·²çŸ¥æ°´é‡)</div>
                </div>
                <div id="mode-dilution" class="pes-mode">
                    <div class="input-group">
                        <label>è¾²è—¥åç¨±</label>
                        <input type="text" id="p_name">
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <div class="input-group">
                            <label>è—¥é‡ (cc/g)</label>
                            <input type="number" id="p_amount" placeholder="500">
                        </div>
                        <div class="input-group">
                            <label>ç¨€é‡‹å€æ•¸</label>
                            <input type="number" id="p_ratio" placeholder="1000">
                        </div>
                    </div>
                    <button class="btn-calc" onclick="calcDilution()">è¨ˆç®—</button>
                    <div id="dilution-result" style="display:none; margin-top:15px;">
                        <div class="result-box">
                            <div>éœ€åŠ æ°´é‡ï¼š<span id="res_water_need" style="font-size:20px; font-weight:bold;">0</span> L</div>
                            <div>ç¸½è—¥æ¶²é‡ï¼š<span id="res_total" style="font-size:20px; font-weight:bold;">0</span> L</div>
                        </div>
                    </div>
                </div>

                <div id="mode-amount" class="pes-mode" style="display:none;">
                    <div class="input-group">
                        <label>ç›®æ¨™ç¸½æ°´é‡ (å…¬å‡)</label>
                        <input type="number" id="a_water" placeholder="100">
                    </div>
                    <div class="input-group">
                        <label>ç¨€é‡‹å€æ•¸</label>
                        <input type="number" id="a_ratio" placeholder="500">
                    </div>
                    <button class="btn-calc" onclick="calcAmount()">è¨ˆç®—</button>
                    <div id="amount-result" style="display:none; margin-top:15px;">
                        <div class="result-box">
                            <div>éœ€è¦è¾²è—¥ï¼š<span id="res_pest_need" style="font-size:24px; font-weight:bold;">0</span> cc(g)</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

<script>
    // --- åˆå§‹åŒ– ---
    document.addEventListener("DOMContentLoaded", function() {
        initMixTable();
        // è‡ªå‹•å…¨é¸åŠŸèƒ½
        document.querySelectorAll("input").forEach(el => {
            el.addEventListener("click", function() { this.select(); });
        });
    });

    function switchMainTab(tabId, btn) {
        document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        btn.classList.add('active');
    }

    function switchPesMode(modeId, btn) {
        document.querySelectorAll('.pes-mode').forEach(el => el.style.display = 'none');
        document.querySelectorAll('.toggle-btn').forEach(el => el.classList.remove('active'));
        document.getElementById(modeId).style.display = 'block';
        btn.classList.add('active');
    }

    // --- Tab 2: å¤šåˆä¸€è¾²è—¥èª¿é…é‚è¼¯ (WALESåŸå‰‡) ---
    const FORMULATION_ORDER = {
        "fert":  { rank: 1, name: "è‚¥æ–™/èª¿ç¯€åŠ‘", badge: "badge-1" },
        "solid": { rank: 2, name: "å›ºé«” (WP/WG/SP)", badge: "badge-2" }, 
        "sc":    { rank: 3, name: "æ‡¸æµ® (SC/CS)", badge: "badge-3" }, 
        "sl":    { rank: 4, name: "æ°´åŠ‘ (SL/EW)", badge: "badge-4" },    
        "oil":   { rank: 5, name: "æ²¹æ€§ (EC/OD)", badge: "badge-5" },    
        "adj":   { rank: 6, name: "å±•è‘—åŠ‘", badge: "badge-6" },          
        "other": { rank: 9, name: "å…¶ä»–", badge: "" }
    };

    function initMixTable() {
        const tbody = document.getElementById("mixBody");
        tbody.innerHTML = "";
        for(let i=0; i<8; i++) {
            const tr = document.createElement("tr");
            tr.innerHTML = `
                <td>
                    <select class="mix-type" style="font-size:13px;">
                        <option value="fert">1.è‚¥æ–™/èª¿ç¯€åŠ‘</option>
                        <option value="solid" selected>2.å›ºé«” (WP,WG,SP,GR,DP,EG,SG)</option>
                        <option value="sc">3.æ‡¸æµ® (SC,DC,CS,SE)</option>
                        <option value="sl">4.æ°´åŠ‘ (SL,ME,EW)</option>
                        <option value="oil">5.ä¹³åŠ‘/æ²¹ (EC,OD,OF,OL)</option>
                        <option value="adj">6.å±•è‘—åŠ‘</option>
                    </select>
                </td>
                <td><input type="text" class="mix-name" placeholder="è—¥å"></td>
                <td>
                    <select class="mix-method" onchange="toggleMixInput(this)">
                        <option value="ratio">ç¨€é‡‹å€æ•¸</option>
                        <option value="area">æ¯å…¬é ƒç”¨é‡</option>
                    </select>
                </td>
                <td><input type="number" class="mix-val" placeholder="ä¾‹: 1000"></td>
                <td><input type="number" class="mix-pack" placeholder="è¦æ ¼"></td>
                <td><button onclick="clearRow(this)" style="background:#f3f4f6;border:1px solid #ccc;border-radius:4px;width:30px;height:30px;">âŒ</button></td>
            `;
            tbody.appendChild(tr);
        }
    }

    function toggleMixInput(selectEl) {
        const row = selectEl.closest("tr");
        const valInput = row.querySelector(".mix-val");
        if(selectEl.value === "ratio") valInput.placeholder = "ä¾‹: 1000";
        else valInput.placeholder = "ä¾‹: 1.5 (Læˆ–kg)";
    }

    function clearRow(btn) {
        const row = btn.closest("tr");
        row.querySelectorAll("input").forEach(i => i.value = "");
        row.querySelector(".mix-type").value = "solid";
    }

    function calcCocktailTotal() {
        // åŸºç¤æ°´é‡è¨ˆç®—
        const jia = parseFloat(document.getElementById("cocktail_area").value) || 0;
        const waterPerFen = parseFloat(document.getElementById("cocktail_water_per_fen").value) || 0;
        
        // 1ç”² = 10åˆ†
        const totalWater = jia * 10 * waterPerFen;
        document.getElementById("cocktail_total_water").innerText = totalWater.toFixed(0);
        return { totalWater, jia };
    }

    function sortAndCalcCocktail() {
        const { totalWater, jia } = calcCocktailTotal();
        if(totalWater <= 0) { alert("è«‹å…ˆè¼¸å…¥æœ‰æ•ˆçš„ä½œæ¥­é¢ç©(ç”²)èˆ‡æ¯åˆ†åœ°ç”¨æ°´é‡"); return; }

        let list = [];
        const rows = document.querySelectorAll("#mixBody tr");
        
        rows.forEach(row => {
            const name = row.querySelector(".mix-name").value.trim();
            const type = row.querySelector(".mix-type").value;
            const method = row.querySelector(".mix-method").value;
            const val = parseFloat(row.querySelector(".mix-val").value);
            const pack = parseFloat(row.querySelector(".mix-pack").value);

            // åªè¦æœ‰å¡«æ•¸å€¼å°±åˆ—å…¥è¨ˆç®—
            if(val > 0) { 
                list.push({ name: name || "(æœªå‘½å)", type, method, val, pack });
            }
        });

        if(list.length === 0) { alert("è«‹è‡³å°‘è¼¸å…¥ä¸€ç¨®è¾²è—¥è³‡æ–™"); return; }

        // â˜… æ ¸å¿ƒï¼šä¾ç…§åŠ‘å‹ Rank é€²è¡Œæ’åº â˜…
        list.sort((a, b) => FORMULATION_ORDER[a.type].rank - FORMULATION_ORDER[b.type].rank);

        // è¨ˆç®—èˆ‡é¡¯ç¤º
        const resBody = document.getElementById("cocktail_result_body");
        resBody.innerHTML = "";
        
        list.forEach((item, idx) => {
            let amount = 0;
            let amountText = "";
            let packText = "-";

            if(item.method === "ratio" && item.val > 0) {
                // æ¨¡å¼A: ç¨€é‡‹å€æ•¸ (ç¸½æ°´é‡ / å€æ•¸)
                amount = totalWater / item.val; 
                // è½‰æˆ cc/g é¡¯ç¤º (1 L = 1000 cc)
                let cc = amount * 1000; 
                amountText = `${cc.toFixed(0)} cc(g)`;
                
                if(item.pack > 0) {
                    let packs = cc / item.pack;
                    packText = `${packs.toFixed(1)} ç½(åŒ…)`;
                }

            } else if(item.method === "area" && item.val > 0) {
                // æ¨¡å¼B: æ¯å…¬é ƒç”¨é‡ (ç”²æ•¸ * 0.97å…¬é ƒ * ç”¨é‡)
                // 1ç”² â‰ˆ 0.9699 å…¬é ƒ -> ç°¡åŒ–ç‚º 0.97
                const ha = jia * 0.9699;
                let totalL = ha * item.val; // ç¸½éœ€é‡ (Læˆ–kg)
                let cc = totalL * 1000;
                amountText = `${cc.toFixed(0)} cc(g)`;
                
                if(item.pack > 0) {
                    let packs = cc / item.pack;
                    packText = `${packs.toFixed(1)} ç½(åŒ…)`;
                }
            }

            const typeInfo = FORMULATION_ORDER[item.type];
            
            const tr = document.createElement("tr");
            tr.innerHTML = `
                <td><span class="step-num">${idx+1}</span></td>
                <td><span class="badge ${typeInfo.badge}">${typeInfo.name}</span></td>
                <td style="font-weight:bold;">${item.name}</td>
                <td style="color:var(--primary); font-weight:900; font-size:18px;">${amountText}</td>
                <td style="color:var(--text-sub);">${packText}</td>
            `;
            resBody.appendChild(tr);
        });

        document.getElementById("cocktail_results").style.display = "block";
        // æ»¾å‹•åˆ°çµæœ
        setTimeout(() => {
            document.getElementById("cocktail_results").scrollIntoView({ behavior: 'smooth', block: 'start' });
        }, 100);
    }

    // --- Tab 1: æ¤ä¿æ©Ÿç•ç”¨é‡è¨ˆç®— (ä¿æŒåŸå§‹é‚è¼¯) ---
    function calcDrone() {
        const sprayPerFen = parseFloat(document.getElementById('sprayPerFen').value);
        const actualMu = parseFloat(document.getElementById('actualMu').value);
        const muToFen = 0.687; 
        const jiaCoef = 14.54; 

        if (!isNaN(sprayPerFen)) {
            // è‡ªå‹•è£œå„Ÿ +0.05
            const sprayPerMuNum = (sprayPerFen * muToFen) + 0.05;
            document.getElementById('sprayPerMu').innerText = sprayPerMuNum.toFixed(2);
            document.getElementById('record_mu_dosage').value = sprayPerMuNum.toFixed(2);

            if (!isNaN(actualMu)) {
                document.getElementById('fenResult').innerText = (actualMu * muToFen).toFixed(2);
                document.getElementById('totalSprayMu').innerText = (actualMu * sprayPerMuNum).toFixed(2);
                
                // ä¸€ç”²åœ°ç”¨é‡è¨ˆç®—
                const sprayPerJia = (jiaCoef * sprayPerMuNum).toFixed(2);
                document.getElementById('sprayPerJia').textContent = sprayPerJia;
            }
        }
    }

    // --- Tab 3: å–®é …ç¨€é‡‹ (ä¿æŒåŸå§‹é‚è¼¯) ---
    function calcDilution() {
        const amount = parseFloat(document.getElementById("p_amount").value);
        const dilution = parseFloat(document.getElementById("p_ratio").value);
        if(amount>0 && dilution>0){
            const amountL = amount / 1000;
            const water = amountL * (dilution - 1);
            const total = amountL + water;
            document.getElementById("res_water_need").innerText = water.toFixed(2);
            document.getElementById("res_total").innerText = total.toFixed(2);
            document.getElementById("dilution-result").style.display = "block";
        }
    }

    function calcAmount() {
        const water = parseFloat(document.getElementById("a_water").value);
        const ratio = parseFloat(document.getElementById("a_ratio").value);
        if(water>0 && ratio>0){
            const pest = (water / ratio) * 1000;
            document.getElementById("res_pest_need").innerText = pest.toFixed(1);
            document.getElementById("amount-result").style.display = "block";
        }
    }
</script>
</body>
</html>